{% extends "base.html" %}

{% block title %}Speech Coach - Speech Practice Coach{% endblock %}

{% block content %}
<section class="page-section" style="background-color: var(--bg-light);">
  <div class="container">
    <header style="margin-bottom: 2rem;">
      <h1 style="font-size: 2.5rem; margin-bottom: 0.5rem;">Speech Coach</h1>
      <p style="color: var(--text-light); font-size: 1.1rem;">Record, compare, and refine your delivery</p>
      <p style="color: var(--text-light); font-size: 0.9rem; margin-top: 0.5rem;">Choose a sentence or paragraph, record your attempt, and receive instant similarity scores.</p>
    </header>

    {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
    <div style="margin-bottom: 2rem;">
      {% for category, message in messages %}
      {% set level = 'danger' if category == 'error' else 'success' if category == 'success' else 'info' %}
      <div class="alert alert-{{ level }}">
        {{ message }}
      </div>
      {% endfor %}
    </div>
    {% endif %}
    {% endwith %}

    <div class="card" style="margin-bottom: 2rem;">
      <h2 style="font-size: 1.2rem; margin-bottom: 1rem;">Choose practice mode</h2>
      <div style="display: flex; gap: 2rem; flex-wrap: wrap; margin-bottom: 1rem;">
        <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
          <input type="radio" name="contentType" value="sentence" checked style="cursor: pointer;">
          <span>Sentences</span>
        </label>
        <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
          <input type="radio" name="contentType" value="paragraph" style="cursor: pointer;">
          <span>Paragraphs</span>
        </label>
      </div>
      <p style="font-size: 0.85rem; color: var(--text-light);">Switch modes, then tap Next to cycle through available practice passages.</p>
    </div>

    <div class="card" style="margin-bottom: 2rem;">
      <h2 id="contentHeading" style="font-size: 1.3rem; margin-bottom: 1rem;">{{ 'Practice Sentence' if sentences else ('Practice Paragraph' if paragraphs else 'Practice Content') }}</h2>
      <p id="targetContent" style="font-size: 1.2rem; line-height: 1.8; margin-bottom: 1rem; color: var(--text-dark);">{{ sentences[0].text if sentences else (paragraphs[0].text if paragraphs else '') }}</p>
      <button id="nextContent" class="btn btn-secondary">Next</button>
    </div>

    <div class="card" style="margin-bottom: 2rem;">
      <div style="display: flex; gap: 1rem; flex-wrap: wrap; margin-bottom: 1rem;">
        <button id="startBtn" class="btn btn-primary" style="flex: 1; min-width: 200px;">Start Recording</button>
        <button id="stopBtn" class="btn" style="flex: 1; min-width: 200px; background-color: #6c757d; color: white; cursor: not-allowed;" disabled>Stop Recording</button>
      </div>
      <p id="statusMessage" style="color: var(--text-light);">Press start to begin recording.</p>
    </div>

    <div class="card" id="results" hidden>
      <h2 style="font-size: 1.3rem; margin-bottom: 1rem;">Results</h2>
      <div style="margin-bottom: 1.5rem;">
        <p style="font-size: 0.75rem; text-transform: uppercase; color: var(--text-light); margin-bottom: 0.5rem;">Transcript</p>
        <div id="transcriptText" style="background-color: var(--bg-light); padding: 1rem; border-radius: 8px; font-size: 1rem;">-</div>
      </div>
      <div>
        <p style="font-size: 0.75rem; text-transform: uppercase; color: var(--text-light); margin-bottom: 0.5rem;">Similarity Score</p>
        <p id="scoreValue" style="font-size: 2.5rem; font-weight: 600; color: var(--secondary-color);">0%</p>
      </div>
    </div>
  </div>
</section>
{% endblock %}

{% block scripts %}
<script>
  window.APP_CONFIG = {
    sentences: {{ sentences | tojson }},
    paragraphs: {{ paragraphs | tojson }},
  };
</script>
<script src="{{ url_for('static', filename='js/app.js') }}" defer></script>
{% endblock %}



